<ion-header>
  <ion-toolbar class="ion-no-border ion-no-shadow">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" fill="clear" aria-label="Volver">
        <ion-icon name="arrow-back-outline" color="dark"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="header-title">
      {{ getHeaderTitle() }}
    </ion-title>
    <ion-buttons slot="end">
      <!-- Empty slot to keep title centered -->
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">
  <ion-searchbar
    class="search-bar"
    placeholder="Buscar recetas"
    debounce="500"
    [value]="searchText()"
    (ionInput)="updateSearch($event)"
    (ionClear)="clearSearch()"
    mode="ios"
  ></ion-searchbar>

  <div class="time-filters ion-margin-bottom">
    <ion-row>
      <ion-col>
        <ion-button 
          class="time-chip" 
          [class.selected]="time === 10"
          (click)="toggleTimeFilter(10)">
          10 minutos
        </ion-button>
      </ion-col>
      <ion-col>
        <ion-button 
          class="time-chip" 
          [class.selected]="time === 20"
          (click)="toggleTimeFilter(20)">
          20 minutos
        </ion-button>
      </ion-col>
      <ion-col>
        <ion-button 
          class="time-chip" 
          [class.selected]="time === 30"
          (click)="toggleTimeFilter(30)">
          30 minutos
        </ion-button>
      </ion-col>
    </ion-row>
  </div>

  <div [hidden]="searchText() !== '' || showHorizontalCards">
    <div class="recipe-list" [hidden]="loading() === true">
      <!-- Show favorites only if not coming from meal time navigation -->
      <div class="recipe-library" button [routerLink]="['recipe-favorites']" *ngIf="!fromMealTime">
        <h2 class="library-text">Tus recetas favoritas</h2>

        <button class="button">
          <img src="../../../../assets/imgs/botton.svg" alt="" />
        </button>
      </div>

      <swiper-container
        slides-per-view="auto"
        pagination="false"
        auto-height="true"
        space-between="16"
        *ngIf="recipesFavorites.length > 0 && !fromMealTime"
      >
        <ng-container *ngFor="let recipe of recipesFavorites">
          <swiper-slide style="width: 200px;">
            <ng-container>
              <app-recipe-slide [recipe]="recipe"></app-recipe-slide>
            </ng-container>
          </swiper-slide>
        </ng-container>
      </swiper-container>

      <p class="ion-padding" *ngIf="recipesFavorites.length === 0 && !fromMealTime">
        No se ha encontrado ninguna receta.
      </p>

      <div class="recipe-library" *ngIf="!fromMealTime || selectedMealTime === 'Breakfast'">
        <h2 class="library-text">Desayuno</h2>

        <button class="button" [routerLink]="['/private/nutrition/recipe-library/breakfast']">
          <img src="../../../../assets/imgs/button.svg" alt="" />
        </button>
      </div>

      <swiper-container
        slides-per-view="auto"
        pagination="false"
        auto-height="true"
        space-between="16"
        *ngIf="recipesBreakfast.length > 0"
      >
        <ng-container *ngFor="let recipe of recipesBreakfast">
          <swiper-slide style="width: 200px;">
            <ng-container>
              <app-recipe-slide [recipe]="recipe"></app-recipe-slide>
            </ng-container>
          </swiper-slide>
        </ng-container>
      </swiper-container>

      <p class="ion-padding" *ngIf="recipesBreakfast.length === 0">
        No se ha encontrado ninguna receta.
      </p>

      <div class="recipe-library" *ngIf="!fromMealTime || selectedMealTime === 'Lunch'">
        <h2 class="library-text">Comida</h2>

        <button class="button" [routerLink]="['/private/nutrition/recipe-library/lunch']">
          <img src="../../../../assets/imgs/button.svg" alt="" />
        </button>
      </div>

      <swiper-container
        slides-per-view="auto"
        pagination="false"
        auto-height="true"
        space-between="16"
        *ngIf="recipesLunch.length > 0"
      >
        <ng-container *ngFor="let recipe of recipesLunch">
          <swiper-slide style="width: 200px;">
            <ng-container>
              <app-recipe-slide [recipe]="recipe"></app-recipe-slide>
            </ng-container>
          </swiper-slide>
        </ng-container>
      </swiper-container>

      <p class="ion-padding" *ngIf="recipesLunch.length === 0">
        No se ha encontrado ninguna receta.
      </p>

      <div class="recipe-library" *ngIf="!fromMealTime || selectedMealTime === 'Dinner'">
        <h2 class="library-text">Cena</h2>

        <button class="button" [routerLink]="['/private/nutrition/recipe-library/dinner']">
          <img src="../../../../assets/imgs/button.svg" alt="" />
        </button>
      </div>

      <swiper-container
        slides-per-view="auto"
        pagination="false"
        auto-height="true"
        space-between="16"
        *ngIf="recipesDinner.length > 0"
      >
        <ng-container *ngFor="let recipe of recipesDinner">
          <swiper-slide style="width: 200px;">
            <ng-container>
              <app-recipe-slide [recipe]="recipe"></app-recipe-slide>
            </ng-container>
          </swiper-slide>
        </ng-container>
      </swiper-container>
      <p class="ion-padding" *ngIf="recipesDinner.length === 0">
        No se ha encontrado ninguna receta.
      </p>

      <div class="recipe-library" *ngIf="!fromMealTime || selectedMealTime === 'Snacks'">
        <h2 class="library-text">Snack</h2>

        <button class="button" [routerLink]="['/private/nutrition/recipe-library/snack']">
          <img src="../../../../assets/imgs/button.svg" alt="" />
        </button>
      </div>

      <swiper-container
        slides-per-view="auto"
        pagination="false"
        auto-height="true"
        space-between="16"
        *ngIf="recipesSnacks.length > 0"
      >
        <ng-container *ngFor="let recipe of recipesSnacks">
          <swiper-slide style="width: 200px;">
            <ng-container>
              <app-recipe-slide [recipe]="recipe"></app-recipe-slide>
            </ng-container>
          </swiper-slide>
        </ng-container>
      </swiper-container>

      <p class="ion-padding" *ngIf="recipesSnacks.length === 0">
        No se ha encontrado ninguna receta.
      </p>
    </div>
    <div class="ion-padding" [hidden]="loading() === false">
      <h3>
        <ion-skeleton-text
          [animated]="true"
          style="width: 80%"
        ></ion-skeleton-text>
      </h3>
      <p>
        <ion-skeleton-text
          [animated]="true"
          style="width: 60%"
        ></ion-skeleton-text>
      </p>
      <p>
        <ion-skeleton-text
          [animated]="true"
          style="width: 30%"
        ></ion-skeleton-text>
      </p>
    </div>
  </div>

  <!-- Show horizontal cards when coming from meal time navigation -->
  <div *ngIf="showHorizontalCards && !searchText()">
    <ng-container *ngFor="let recipe of filteredRecipesForHorizontalView">
      <ion-row
        [class]="'recipe_' + (recipe.section?.toLowerCase() || '')"
      >
        <ion-col
          size="4"
          class="recipe-image"
          [ngStyle]="{ backgroundImage: 'url(' + recipe.image + ')' }"
        >
        </ion-col>

        <ion-col size="8" class="ion-padding recipe-content">
          <div class="text-content">
            <div class="diet-type">{{ getMealTimeDisplayName() }} - {{ getDietTypeDisplay(recipe.description) }}</div>
            <div class="recipe-title">{{ recipe.title }}</div>
          </div>

          <div class="recipe-text">
            <div class="points">
              <img
                *ngFor="let number of [].constructor(recipe.value || 0); let i = index"
                src="../../../../../assets/imgs/nutrition/traffic-light-on.svg"
                style="width: 18px; height: 18px"
              />
              <img
                *ngFor="let number of [].constructor(4 - (recipe.value || 0)); let i = index"
                src="../../../../../assets/imgs/nutrition/traffic-light-off.svg"
                style="width: 18px; height: 18px"
              />
            </div>
            <div class="time">
              <img
                *ngIf="recipe.section !== 'Breakfast'"
                src="../../../../../assets/icons/initFormIcons/clock_green_solid.svg"
                style="width: 16px; height: 16px"
              />
              <img
                *ngIf="recipe.section === 'Breakfast'"
                src="../../../../../assets/icons/initFormIcons/clock_black_solid.svg"
                style="width: 16px; height: 16px"
              />
              <span> {{ recipe.time }}'</span>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ng-container>
    
    <p class="ion-padding" *ngIf="filteredRecipesForHorizontalView.length === 0">
      No se encontraron recetas para este momento del d√≠a.
    </p>
  </div>

  <app-recipe-search
    [hidden]="searchText() === ''"
    [recipes]="searchedRecipes"
  ></app-recipe-search>
</ion-content>
